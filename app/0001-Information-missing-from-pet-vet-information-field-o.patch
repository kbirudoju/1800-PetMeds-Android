From ab10062c28aa43c2c3680ba95d4becf8f362b667 Mon Sep 17 00:00:00 2001
From: sdixit-dminc-com <sdixit@dminc.com>
Date: Tue, 15 Nov 2016 19:08:18 +0530
Subject: [PATCH 1/1] Information missing from pet & vet information field on
 review screen

---
 .../java/com/petmeds1800/model/entities/Item.java  | 28 +++++++++++++
 .../ui/checkout/StepTwoRootFragment.java           |  3 ++
 .../ui/checkout/stepfive/StepFiveRootContract.java |  6 +++
 .../ui/checkout/stepfive/StepFiveRootFragment.java | 15 ++++++-
 .../checkout/stepfive/StepFiveRootPresentor.java   | 49 ++++++++++++++++++++++
 .../res/layout/fragment_step_five_checkout.xml     |  4 ++
 6 files changed, 103 insertions(+), 2 deletions(-)

diff --git a/app/src/main/java/com/petmeds1800/model/entities/Item.java b/app/src/main/java/com/petmeds1800/model/entities/Item.java
index 3a2fde3..6244b00 100644
--- a/app/src/main/java/com/petmeds1800/model/entities/Item.java
+++ b/app/src/main/java/com/petmeds1800/model/entities/Item.java
@@ -21,6 +21,34 @@ public class Item implements Serializable{
     private String productName;
     private boolean isRxItem;
     private String parentCategory;
+    private String itemClinicName;
+    private String itemPetName;
+    private String itemDrName;
+
+    public String getItemDrName() {
+        return itemDrName;
+    }
+
+    public void setItemDrName(String itemDrName) {
+        this.itemDrName = itemDrName;
+    }
+
+    public String getItemPetName() {
+        return itemPetName;
+    }
+
+    public void setItemPetName(String itemPetName) {
+        this.itemPetName = itemPetName;
+    }
+
+    public String getItemClinicName() {
+        return itemClinicName;
+    }
+
+    public void setItemClinicName(String itemClinicName) {
+        this.itemClinicName = itemClinicName;
+    }
+
     public boolean isRxItem() {
         return isRxItem;
     }
diff --git a/app/src/main/java/com/petmeds1800/ui/checkout/StepTwoRootFragment.java b/app/src/main/java/com/petmeds1800/ui/checkout/StepTwoRootFragment.java
index 5988def..95cf62c 100644
--- a/app/src/main/java/com/petmeds1800/ui/checkout/StepTwoRootFragment.java
+++ b/app/src/main/java/com/petmeds1800/ui/checkout/StepTwoRootFragment.java
@@ -124,6 +124,9 @@ public class StepTwoRootFragment extends AbstractFragment
         replaceStepRootChildFragment(CommunicationFragment.newInstance(CommunicationFragment.REQUEST_CODE_VALUE),
                 R.id.communicationfragment);
         ButterKnife.bind(this, view);
+        if (((CheckOutActivity) getActivity()).getApplicableSteps() == 3) {
+            mShippingNavigator.setText(getString(R.string.reviewsubmit_navigator_button_title));
+        }
         return view;
     }
 
diff --git a/app/src/main/java/com/petmeds1800/ui/checkout/stepfive/StepFiveRootContract.java b/app/src/main/java/com/petmeds1800/ui/checkout/stepfive/StepFiveRootContract.java
index d59b267..d829d5e 100644
--- a/app/src/main/java/com/petmeds1800/ui/checkout/stepfive/StepFiveRootContract.java
+++ b/app/src/main/java/com/petmeds1800/ui/checkout/stepfive/StepFiveRootContract.java
@@ -2,10 +2,13 @@ package com.petmeds1800.ui.checkout.stepfive;
 
 import com.petmeds1800.model.entities.CommitOrderRequest;
 import com.petmeds1800.model.entities.CommitOrderResponse;
+import com.petmeds1800.model.entities.Item;
 import com.petmeds1800.model.entities.OrderReviewSubmitResponse;
 import com.petmeds1800.mvp.BasePresenter;
 import com.petmeds1800.mvp.BaseView;
 
+import java.util.ArrayList;
+
 /**
  * Created by Sdixit on 29-09-2016.
  */
@@ -23,6 +26,8 @@ public class StepFiveRootContract {
         void showErrorCrouton(CharSequence message, boolean span);
 
         void navigateOnOrderConfirmation(CommitOrderResponse response);
+
+        void setPetVetInfo(String petVetInfo);
     }
 
     interface Presenter extends BasePresenter {
@@ -30,6 +35,7 @@ public class StepFiveRootContract {
         void getOrderReviewDetails(String sessionConfig);
 
         void submitComittedOrderDetails(CommitOrderRequest commitOrderRequest);
+        void populatePetVetInfo(final ArrayList<Item> items, final ArrayList<String> applicableSteps);
 
     }
 }
diff --git a/app/src/main/java/com/petmeds1800/ui/checkout/stepfive/StepFiveRootFragment.java b/app/src/main/java/com/petmeds1800/ui/checkout/stepfive/StepFiveRootFragment.java
index d64dbc8..529e112 100644
--- a/app/src/main/java/com/petmeds1800/ui/checkout/stepfive/StepFiveRootFragment.java
+++ b/app/src/main/java/com/petmeds1800/ui/checkout/stepfive/StepFiveRootFragment.java
@@ -175,6 +175,7 @@ public class StepFiveRootFragment extends AbstractFragment
 
     private static final int SIZE_FOUR = 4;
 
+    private static final int SIZE_FIVE = 5;
 
     private ShippingAddress mShippingAddress;
 
@@ -226,7 +227,7 @@ public class StepFiveRootFragment extends AbstractFragment
     @Nullable
     @Override
     public View onCreateView(LayoutInflater inflater, @Nullable ViewGroup container,
-                             @Nullable Bundle savedInstanceState) {
+            @Nullable Bundle savedInstanceState) {
         View view = inflater.inflate(R.layout.fragment_step_five_checkout, container, false);
         ButterKnife.bind(this, view);
 
@@ -308,6 +309,7 @@ public class StepFiveRootFragment extends AbstractFragment
 
     @Override
     public void populateOrderReviewDetails(OrderReviewSubmitResponse response) {
+
         mProgressbar.setVisibility(View.GONE);
         CheckoutSteps checkoutSteps = response.getCheckoutSteps();
         Order mOrder = response.getOrder();
@@ -317,6 +319,8 @@ public class StepFiveRootFragment extends AbstractFragment
         }
         if (mApplicableSteps != null && mApplicableSteps.size() == SIZE_FOUR) {
             mPetVetContainer.setVisibility(View.GONE);
+        } else {
+            mPresenter.populatePetVetInfo((ArrayList<Item>) mOrder.getItems(), mApplicableSteps);
         }
         if (mOrder != null) {
             mSubTotalValue.setText(DOLLAR_SIGN + String.valueOf(mOrder.getOrderSubTotal()));
@@ -330,6 +334,7 @@ public class StepFiveRootFragment extends AbstractFragment
             mShippingAddress = mOrder.getShippingAddress();
             mShippingMethod = mOrder.getShippingMethod();
             mPaymentMethod = mOrder.getPaymentMethod();
+
             if (mShippingAddress != null) {
                 mShippingAddressDetailsText.setText(
                         mShippingAddress.getAddress1() + BLANK_SPACE + mShippingAddress.getAddress2() + BLANK_SPACE
@@ -353,6 +358,7 @@ public class StepFiveRootFragment extends AbstractFragment
 
     }
 
+
     @Override
     public void onError(String errorMessage) {
         if (mProgressbar.getVisibility() == View.VISIBLE) {
@@ -382,6 +388,11 @@ public class StepFiveRootFragment extends AbstractFragment
     }
 
     @Override
+    public void setPetVetInfo(String petVetInfo) {
+        mPetVetDetailsText.setText(petVetInfo);
+    }
+
+    @Override
     public void setPresenter(StepFiveRootContract.Presenter presenter) {
         mPresenter = presenter;
     }
@@ -407,7 +418,7 @@ public class StepFiveRootFragment extends AbstractFragment
 
     @Override
     public void openDailog(String[] data, int code, String title, int defaultValue, final TextView textview,
-                           final int selectedPosition, final ArrayList<String> reorderMonthsList) {
+            final int selectedPosition, final ArrayList<String> reorderMonthsList) {
 
         FragmentManager fragManager = getFragmentManager();
         CommonDialogFragment commonDialogFragment = CommonDialogFragment
diff --git a/app/src/main/java/com/petmeds1800/ui/checkout/stepfive/StepFiveRootPresentor.java b/app/src/main/java/com/petmeds1800/ui/checkout/stepfive/StepFiveRootPresentor.java
index cd8ad0b..24e7d71 100644
--- a/app/src/main/java/com/petmeds1800/ui/checkout/stepfive/StepFiveRootPresentor.java
+++ b/app/src/main/java/com/petmeds1800/ui/checkout/stepfive/StepFiveRootPresentor.java
@@ -4,10 +4,16 @@ import com.petmeds1800.PetMedsApplication;
 import com.petmeds1800.api.PetMedsApiService;
 import com.petmeds1800.model.entities.CommitOrderRequest;
 import com.petmeds1800.model.entities.CommitOrderResponse;
+import com.petmeds1800.model.entities.Item;
 import com.petmeds1800.model.entities.OrderReviewSubmitResponse;
 
+import android.util.Log;
+
+import java.util.ArrayList;
+
 import javax.inject.Inject;
 
+import rx.Observable;
 import rx.Subscriber;
 import rx.android.schedulers.AndroidSchedulers;
 import rx.schedulers.Schedulers;
@@ -101,5 +107,48 @@ public class StepFiveRootPresentor implements StepFiveRootContract.Presenter {
                     }
                 });
     }
+
+    @Override
+    public void populatePetVetInfo(final ArrayList<Item> items, final ArrayList<String> applicableSteps) {
+        //we need to perform this unnecessary conversion into Address model as reusable 'AddEditFragment' only knows about Address model
+        Observable.create(new Observable.OnSubscribe<String>() {
+            @Override
+            public void call(Subscriber<? super String> subscriber) {
+
+                String petVetInfo = "";
+                if (applicableSteps != null && applicableSteps.size() == 5 && items != null) {
+                    for (Item item : items) {
+                        if (item.isRxItem()) {
+                            petVetInfo = petVetInfo + item.getItemPetName() + "," + item.getItemDrName();
+                        }
+                    }
+                }
+                subscriber.onNext(petVetInfo);
+
+            }
+        })
+                .subscribeOn(Schedulers.computation())
+                .observeOn(AndroidSchedulers.mainThread())
+                .subscribe(new Subscriber<String>() {
+                    @Override
+                    public void onCompleted() {
+
+                    }
+
+                    @Override
+                    public void onError(Throwable e) {
+                        Log.d("StepFive", e.getLocalizedMessage());
+                    }
+
+                    @Override
+                    public void onNext(String petVetInfo) {
+                        if (mView.isActive()) {
+                            mView.setPetVetInfo(petVetInfo);
+                        }
+                    }
+                });
+
+    }
 }
 
+
diff --git a/app/src/main/res/layout/fragment_step_five_checkout.xml b/app/src/main/res/layout/fragment_step_five_checkout.xml
index 575efe9..ca43dc9 100644
--- a/app/src/main/res/layout/fragment_step_five_checkout.xml
+++ b/app/src/main/res/layout/fragment_step_five_checkout.xml
@@ -169,15 +169,19 @@
                         android:layout_marginLeft="@dimen/dp_16"
                         android:id="@+id/petVetDetailsText"
                         android:layout_width="wrap_content"
+                        android:maxLines="1"
+                        android:ellipsize="end"
                         android:layout_height="@dimen/dp_50"
                         style="@style/rounded_button_text"
                         android:layout_below="@+id/petVetText"
                 />
                 <ImageButton
+
                         android:padding="@dimen/dp_10"
                         android:background="@android:color/transparent"
                         android:src="@drawable/ic_small_edit"
                         android:id="@+id/petVetEdit"
+
                         android:layout_width="wrap_content"
                         android:layout_height="wrap_content"
                         android:layout_marginRight="19dp"
-- 
2.9.3.windows.1

